<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE X3D PUBLIC "ISO//Web3D//DTD X3D 4.0//EN" "http://www.web3d.org/specifications/x3d-4.0.dtd">
<X3D profile='Interchange' version='4.0' xmlns:xsd='http://www.w3.org/2001/XMLSchema-instance' xsd:noNamespaceSchemaLocation='http://www.web3d.org/specifications/x3d-4.0.xsd'>
  <head>
    <component name='Scripting' level='1'/>
    <component name='X_ITE' level='1'/>
    <meta name='created' content='Tue, 07 May 2024 18:25:47 GMT'/>
    <meta name='creator' content='Holger Seelig'/>
    <meta name='generator' content='Sunrize X3D Editor V1.6.12, https://create3000.github.io/sunrize/'/>
    <meta name='modified' content='Tue, 07 May 2024 20:04:26 GMT'/>
  </head>
  <Scene>
    <WorldInfo/>
    <Viewpoint
        description='Initial View'
        position='35.04574 47.28346 107.4973'
        orientation='-0.776588739330481 0.61771873128448 0.123828506271318 0.5052317'
        centerOfRotation='-0.1622944 -0.005331993 -0.09907389'/>
    <InstancedShape DEF='_1'
        translations='9.43632 4.773011 -4.869959, 4.713242 2.318003 1.053635, -1.03472 -3.495855 1.841974, 2.943848 0.5153412 0.6717855, 2.237322 1.169527 -2.003426, 7.819233 1.120518 -9.901926, -4.426062 -4.110686 1.04961, -5.23025 6.939774 -7.109693, 2.50181 0.4458607 -0.8953159, 5.717723 -1.707173 4.218315, 6.490097 -1.956163 4.30584, 5.439374 1.4682 4.530069, 3.980282 -8.014851 8.80284, -5.204966 1.110489 0.9734173, -0.5908011 -5.593042 1.010979, 1.623217 1.034929 1.514917, -6.986652 -1.387992 -5.706308, 0.2792436 0.3398955 -3.29361, 2.127888 -1.762193 6.53907, -7.264628 -1.143926 -2.612074, 0.2967412 2.551219 -3.500814, 0.6202707 -0.2932694 1.463264, -6.160116 0.1655401 8.470655, -0.8066078 -1.267268 4.292928, -4.175788 3.753085 3.488842, 2.335739 1.172676 0.0007710558, 7.422938 -0.09906831 4.44118, -6.745408 -5.632707 0.4598785, 7.896064 -1.518331 0.5894874, 3.719481 -2.597703 7.335749, 0.245397 1.545594 -0.4352976, -0.0007676546 -3.134588 -9.306463, 1.976637 1.121882 1.306039, -1.083608 -2.342571 3.331958, 6.257779 1.842316 -2.396911, 0.5465739 -6.38062 -5.886823, -7.330467 -9.591173 4.783422, 1.296702 -1.291345 -2.090067, 4.750603 -3.538118 4.130668, 0.4929221 0.8870572 -0.6463842, 0.4044753 2.244098 0.3154069, 3.749222 0.3868864 3.840712, -0.8729321 3.15885 -3.481226, -0.763864 -0.9987049 4.360027, 0.08462658 1.651298 0.6369348, -1.366804 0.7588438 -3.290773, 4.549198 -1.179882 1.919278, 1.718208 -0.05759323 -0.08134609, 2.238334 5.131457 0.6624244, 2.00594 -1.934584 -4.183235, -0.008018934 -3.828667 3.722793, -1.45117 0.6306759 -1.293299, 0.126412 2.595212 -0.004490765, 5.500216 -3.732739 5.786733, 4.986724 3.027322 5.381568, 1.433984 2.367994 0.4764308, 5.540357 5.724402 6.796672, 0.04888066 0.05258391 -1.118828, 5.151761 -0.401143 6.970664, -0.2445758 1.660268 0.4969645, 2.701528 1.980516 -0.7329811, 5.444829 1.652448 -0.6777117, 5.082972 1.15281 -2.463335, 8.220087 -1.486502 7.048542, 2.242978 1.321985 -1.24164, 2.51289 0.786846 -0.8133072, -1.58007 -2.085186 1.137961, 0.8149955 2.108868 0.6227729, 2.836018 1.041851 -0.4462171, 0.7971721 -0.3160899 -0.805253, 2.799901 -3.077142 4.363897, 2.743657 2.628776 -0.08237948, 2.441111 0.7337366 -0.3138673, 1.63882 -1.058795 4.499923, -0.3896192 0.09376586 2.139909, 3.131985 1.072253 1.508028, 8.238625 2.831014 -8.31394, 1.143347 0.1603093 -0.2429642, 0.4574296 2.227445 0.04665074, 4.721576 0.2329635 0.35858, 1.370687 0.3183995 0.5097787, -1.023581 1.560232 1.936663, 3.735353 1.124121 1.552383, 0.1616251 4.346741 1.634092, 2.387313 0.09924228 0.9390268, -1.837923 1.813029 -1.685511, -0.844456 -3.354636 3.824014, 8.620333 -0.310136 5.131894, 5.124669 2.996572 5.675629, 2.4508 1.388218 -0.6888406, 1.53993 1.191325 0.4445104, 0.2519351 -1.159716 -1.947137, 0.9311689 1.467288 -0.4684477, 5.461936 -0.4535681 -4.075318, -1.339687 -3.271028 5.705119, -1.095977 -1.937524 0.3309639, 0.2789412 3.401916 0.85162, 4.343462 2.325284 1.037095, -2.308589 7.843136 3.587142, 1.82646 0.8739151 1.466885'
        bboxDisplay='true'>
      <Appearance>
        <PointProperties
            pointSizeScaleFactor='5'
            pointSizeMinValue='5'
            pointSizeMaxValue='5'/>
      </Appearance>
      <PointSet>
        <Coordinate
            point='0 0 0, 0.1 0 0, -0.1 0 0, 0 0.1 0, 0 -0.1 0'/>
      </PointSet>
    </InstancedShape>
    <TimeSensor DEF='_2'
        loop='true'/>
    <Script DEF='ParticlesScript'>
      <field accessType='inputOutput' type='SFInt32' name='numParticles' value='100'/>
      <field accessType='initializeOnly' type='MFVec3f' name='velocities' value='0.05992992 -0.3482256 1.484762, -1.790449 -1.110145 0.4130602, 0.8069682 2.133338 0.9567456, 0.5807074 -1.889855 0.6737839, 3.881769 0.009490276 1.224385, -0.2785949 -0.6547909 0.3595136, 2.236704 1.904368 -0.1842268, 0.8216555 -1.088066 0.8886352, 2.768995 -1.89024 -1.043935, -0.5793421 1.584858 -2.098006, -1.538604 0.9825642 0.5611984, -2.312411 -1.395013 -1.897898, 0.561294 0.8963655 -0.6206496, 1.679669 0.01901416 -2.095017, -0.4705663 1.887874 1.161587, 1.733815 2.325124 -0.6210659, 1.620076 -0.3359128 0.6374392, 2.075342 2.525342 1.271393, -1.654433 0.448099 -0.9651577, 1.214635 0.670548 1.632432, 1.339369 -2.023408 3.777786, 2.086315 2.621214 -2.484545, 1.252527 0.4333664 -0.6380352, 3.520694 2.524812 1.970884, 1.34217 -1.380642 -0.8245391, 0.1645577 2.086629 1.05638, -0.7719107 -1.313721 -1.051109, 1.722823 0.278954 1.610949, -1.615824 2.286536 -0.05367206, -0.66829 1.316781 -0.8087683, -1.647256 -2.104181 -2.195578, -0.893757 0.613025 1.069962, -0.94585 -2.852789 -0.7205135, 3.834012 -0.1137716 -1.869296, -2.485966 -2.532882 0.2966917, -0.6606014 1.175495 1.516467, 1.074944 0.311242 -0.9019493, -0.8586204 3.364023 1.945433, -0.8924147 -0.5538649 -0.9574323, -0.9603512 -3.740023 1.202324, 1.635739 -2.926399 -2.482922, -1.506198 1.591693 -2.025745, -0.8872077 -1.634158 1.342943, 2.004424 1.992131 -2.173653, -0.5947047 0.7147363 -1.063473, 0.8224474 3.13674 0.01205262, -0.5206238 1.57598 -3.418994, 0.5747144 2.360325 -3.740259, -0.1165966 -0.8198093 -0.9285039, -2.261677 3.046102 1.113397, 0.8986399 2.210632 -1.386174, 2.986125 0.6324193 1.215798, 1.333099 -2.782912 0.7077687, 0.8402272 1.267321 -2.646688, -2.240815 -1.258081 -1.641736, 0.5816718 -3.407526 3.428153, -0.02799825 -1.87366 -1.242894, 2.61497 2.080308 2.895493, -1.716598 1.979953 -1.527702, 1.01943 -2.534098 -0.298878, -4.39288 0.6100848 0.05292858, -1.296584 -1.784505 0.1876438, -2.128736 0.08588101 1.623364, -1.432034 1.792348 -1.597413, -1.26631 4.994164 0.3526442, 2.977649 -0.3571188 2.817679, -0.8693865 2.658864 -0.6212626, 2.675855 -4.177525 -1.421369, -1.183201 -1.255265 -1.165877, -1.031807 0.9207556 -2.556821, -1.024358 1.103671 -2.581942, 0.4634261 -1.58313 2.079009, -2.473029 -0.43269 1.428251, -1.306641 1.454489 -0.2459157, 0.6181511 2.599422 -1.114692, -4.258287 0.3087133 1.178816, -0.3678631 -0.355662 0.8437236, 2.094753 0.459466 -1.528505, 3.857576 -3.541099 -1.262426, -2.372186 -0.4086374 1.004263, -0.5596239 1.912173 4.106033, 3.093547 0.7064301 2.027293, -3.957 -2.102399 -0.01009076, -0.1288588 -3.808153 0.6441388, -0.9192248 -3.622644 2.69748, 1.068208 -2.203958 2.322429, 2.054283 2.419088 0.03020497, -1.276417 1.279711 -0.2993965, 1.516057 -1.534735 -1.678882, 0.1268017 -1.747396 -0.915781, -0.3607409 2.789247 -1.742248, 2.662977 -0.8064051 2.560304, 0.2540048 2.126006 3.567112, -1.569726 1.456269 2.392572, 0.432396 1.479396 -2.5362, 0.4315485 2.448993 0.2511591, 1.079121 -4.284444 3.164566, -3.762611 1.403298 0.268236, 1.362142 -0.8227679 -1.001428, -2.514287 0.1982658 -3.576655'/>
      <field accessType='initializeOnly' type='MFFloat' name='masses' value='611136.3, 657356.5, 613554.7, 726108.5, 736045.6, 681784.8, 905858.3, 672522.5, 875047.6, 673304.8, 577830.2, 863724.3, 629701.3, 644311.8, 582117.6, 888813.6, 868011.4, 735855.4, 538790.6, 599413.4, 912326.7, 804721.7, 578866.9, 980633, 539212.6, 645525.4, 550872.1, 860223.1, 793173.2, 710011.3, 856610.9, 675927.9, 922502.9, 770945.9, 826493, 986581.8, 897254.4, 791246.9, 531580.6, 571681.2, 553541.4, 994756.6, 560714.6, 928539, 993898.3, 511841.7, 912738.8, 549003.3, 549109.4, 940652.4, 905504.3, 609311.7, 546100.9, 723502, 967673.3, 713637.6, 948694.1, 972159.8, 562050, 861425, 845079.4, 562897.5, 642689.5, 753781.6, 985246.3, 958886.2, 601312.6, 751119.5, 732446.9, 778774, 812066.2, 865951.5, 814889.1, 610466.1, 819435.5, 760626.2, 535526.9, 752095.1, 618903.9, 541340.2, 804145.5, 966116.3, 861421.6, 740689.2, 912019.7, 626326.6, 637939.1, 527698.8, 566633.5, 506598.3, 527556.7, 601988.7, 889378.4, 875668.9, 803256.4, 926397.8, 978685.6, 687236.3, 668878.2, 679494.5'/>
      <field accessType='inputOutput' type='MFVec3f' name='forces' value='-18.16236 -11.56449 11.24011, -363.8164 -101.747 -30.66857, 24.37328 60.60837 2.160901, -223.0327 61.24988 -39.00964, -14.79137 -26.89613 282.2188, -9.453926 2.104233 20.59218, 44.05959 31.92615 0.04727523, 10.87831 -11.56041 12.50823, -88.07997 854.5383 289.5099, -4.692801 12.79552 -22.21971, -70.08721 32.0304 -15.67854, -56.23463 -13.57211 -41.72801, -3.849651 16.6547 -13.94052, 47.09599 -6.470745 -3.369341, 7.349614 47.16476 6.033404, 573.8513 -93.33076 -304.6734, 24.73409 5.031632 22.39292, 27.85388 15.14662 113.1087, 3.92743 8.392313 -43.30352, 25.2265 3.011058 7.07468, 9.289824 -53.36426 106.9784, 59.11362 120.0948 -87.60987, 14.82766 -1.040136 -15.07688, 176.3344 485.9319 173.2106, 28.30929 -17.83394 -15.68404, 7.320152 -137.7767 -162.1045, -35.12067 -4.348104 -11.30501, 32.21611 23.07546 3.392417, -56.80878 23.01344 8.523163, -9.186808 21.04066 -49.96389, 241.1575 -67.60796 156.8066, 3.433176 7.876783 24.4659, -272.8235 -360.6442 0.1338528, 59.17127 38.23839 -10.82188, -83.44693 -30.32304 45.45468, 2.730745 33.01546 27.08068, 13.95493 16.69905 -7.081027, -23.37854 109.5804 91.72088, -18.25582 38.92747 -7.619943, 124.5436 87.40297 126.3193, 106.3162 -160.7495 -238.1531, -38.89892 4.424613 -94.93625, 42.80364 -46.0767 47.10654, -83.04253 -494.9775 -349.2655, -51.79329 117.4724 -300.8185, 48.37713 3.196734 56.5807, -78.23472 75.84699 -24.18488, -58.45676 206.309 26.24631, -15.49142 -75.97607 -3.993908, -15.03996 53.96766 82.35146, -29.57623 99.23876 -32.77401, 100.3867 15.69048 39.84011, 177.9849 -253.6375 114.8488, -26.90632 39.61632 -34.40969, 55.1324 -83.66511 331.0325, -98.59356 -202.7202 -22.62343, -18.40054 -39.23151 -33.73531, 179.4765 88.11508 138.4474, -14.93017 -0.4706091 -40.04259, 576.0641 -60.22147 53.08024, -187.6457 -269.4336 137.3109, -78.67926 -20.21543 21.05091, -47.02973 1.008325 56.34566, -33.57795 10.67584 -33.56311, 36.74554 -195.484 438.3932, -120.7725 -298.4299 342.0353, 70.0088 43.1328 -26.89293, -84.23165 -121.2938 -215.0482, -453.0331 -107.2938 -8.783242, 62.10093 198.4534 103.0883, -11.25062 55.09017 -34.86474, -103.8256 -247.6409 -4.039888, -80.65226 246.2844 -182.2011, -3.556824 14.07193 -53.23643, 98.26485 32.64045 -96.05067, -45.86672 -16.71409 -126.3972, -10.92035 -6.665708 12.35541, 120.7436 123.2697 65.15157, 20.23377 -110.8218 324.0877, -95.44608 34.95243 10.33564, 85.81632 131.9169 -130.6857, 156.7167 -44.5443 -111.2077, -245.4547 -34.8149 -116.9216, 35.02515 -121.2783 -58.7656, -80.43607 260.2491 -137.241, 84.68733 -37.9994 44.58209, 49.02119 50.98556 -35.62711, -40.99145 0.372058 -15.45014, -98.6677 7.393917 -423.6945, -12.52132 -193.6856 48.31154, 33.38735 -46.81116 -28.29966, 55.52105 79.45747 71.76263, -39.61001 -97.63407 169.6621, -46.75926 23.12387 59.67436, 33.20363 36.98463 -64.41894, 58.60697 78.7832 49.47589, 75.96446 -233.3967 -53.87346, 159.5698 -48.91296 -12.43572, 14.04051 -28.62044 -11.45351, -296.436 349.2223 -336.1828'/>
      <field accessType='inputOutput' type='SFFloat' name='G' value='6.672e-11'/>
      <field accessType='inputOnly' type='SFTime' name='set_time'/>
      <field accessType='initializeOnly' type='SFNode' name='shape'>
        <InstancedShape USE='_1'/>
      </field>
<![CDATA[ecmascript:

let positions;

function initialize ()
{
   positions = shape .translations;

   set_numParticles ()
}

function set_numParticles ()
{
   for (let i = 0; i < numParticles; ++ i)
   {
      positions [i] = new SFVec3f (random (-10, 10), 
                                   random (-10, 10), 
                                   random (-10, 10));

      velocities [i] = new SFVec3f (random (-1, 1), 
                                    random (-1, 1), 
                                    random (-1, 1));

      masses [i] = random (1, 2) * 500_000;
   }

   positions  .length = numParticles;
   velocities .length = numParticles;
   masses     .length = numParticles;
   forces     .length = numParticles;
}

function set_time (value, time)
{
   const dt = 1 / Browser .currentFrameRate;

   for (let i = 0; i < numParticles; ++ i)
   {
      forces [i] = new SFVec3f ();

      for (let j = 0; j < numParticles; ++ j)
      {
         if (i === j)
            continue;

         const 
            p = positions [j] .subtract (positions [i]),
            r = p .length (),
            F = G * (masses [i] * masses [j]) / (r * r);

         forces [i] = forces [i] .add (p .multiply (F / r));
      }
   }

   for (let i = 0; i < numParticles; ++ i)
   {
      const velocity = forces [i] .multiply (dt * dt);

      velocities [i] = velocities [i] .add (velocity);

      const translation = velocities [i] .multiply (dt);

      positions [i] = positions [i] .add (translation);
   }
}

function random (min, max)
{
   return min + Math .random () * (max - min);
}
]]>
    </Script>
    <ROUTE fromNode='_2' fromField='time' toNode='ParticlesScript' toField='set_time'/>
  </Scene>
</X3D>
