{ "X3D": {
    "encoding": "UTF-8",
    "@profile": "Full",
    "@version": "3.3",
    "@xsd:noNamespaceSchemaLocation": "http://www.web3d.org/specifications/x3d-3.3.xsd",
    "JSON schema": "http://www.web3d.org/specifications/x3d-3.3-JSONSchema.json",
    "head": {
      "meta": [
        {
          "@name": "comment",
          "@content": "World of Titania"
        }
      ],
      "unit": [
        {
          "@category": "angle",
          "@name": "degree",
          "@conversionFactor": 0.0174532925199432958
        },
      ]
    },
    "Scene": {
      "-children": [
        { "NavigationInfo":
          {
            "@type": [ "EXAMINE" ],
            "@transitionType": [ "ANIMATE" ]
          }
        },
        { "Background":
          {
            "@DEF": "Gray",
            "@skyColor": [ 0.2, 0.2, 0.2 ]
          }
        },
        { "Viewpoint":
          {
            "@description": "Initial View",
            "@position": [ 88.6625, 86.1609, 76.3865 ],
            "@orientation": [ -0.580909769224258, 0.777411062318136, 0.241196766572868, 0.981087963955961 ],
            "@centerOfRotation": [ 7, 7, -5 ],
            "@fieldOfView": 0.185755
          }
        },
        { "Group":
          {
            "@DEF": "Cubes",
            "-children": [
              { "Transform":
                {
                  "@translation": [ 1, 1, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@DEF": "ColorCube",
                        "-appearance": { "Appearance":
                          {
                            "-material": { "Material":
                              {
                              }
                            }
                          }
                        },
                        "-geometry": { "IndexedFaceSet":
                          {
                            "@colorIndex": [ 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, 2, 2, 2, 2, -1, 2, 2, 2, 2, -1, 1, 1, 1, 1, -1, 1, 1, 1, 1, -1 ],
                            "@texCoordIndex": [ 0, 1, 2, 3, -1, 0, 1, 2, 3, -1, 0, 1, 2, 3, -1, 0, 1, 2, 3, -1, 0, 1, 2, 3, -1, 0, 1, 2, 3, -1 ],
                            "@coordIndex": [ 0, 1, 2, 3, -1, 5, 4, 7, 6, -1, 3, 2, 6, 7, -1, 4, 5, 1, 0, -1, 4, 0, 3, 7, -1, 1, 5, 6, 2, -1 ],
                            "-color": { "Color":
                              {
                                "@color": [ 1, 0, 0, 1, 0.647059, 0, 0.117647, 0.564706, 1 ]
                              }
                            },
                            "-texCoord": { "TextureCoordinate":
                              {
                                "@point": [ 0, 0, 1, 0, 1, 1, 0, 1 ]
                              }
                            },
                            "-coord": { "Coordinate":
                              {
                                "@point": [ -1, -1, 1, 1, -1, 1, 1, 1, 1, -1, 1, 1, -1, -1, -1, 1, -1, -1, 1, 1, -1, -1, 1, -1 ]
                              }
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 3, 1, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 5, 1, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 7, 1, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 9, 1, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 11, 1, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 1, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 1, -1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 1, -3 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 1, -5 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 1, -7 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 1, -9 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 1, -11 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 3, -11 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 5, -11 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 5, -9 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 5, -7 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 5, -5 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 5, -3 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 5, -1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 5, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 11, 5, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 9, 5, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 7, 5, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 5, 5, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 3, 5, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 1, 5, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 1, 7, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 1, 9, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 3, 9, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 5, 9, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 7, 9, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 9, 9, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 11, 9, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 9, 1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 9, -1 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 9, -3 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 9, -5 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 9, -7 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 9, -9 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 9, -11 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 11, -11 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 13, -11 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 13, -9 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              },
              { "Transform":
                {
                  "@translation": [ 13, 13, -7 ],
                  "-children": [
                    { "Shape":
                      {
                        "@USE": "ColorCube"
                      }
                    }
                  ]
                }
              }
            ]
          }
        },
        { "TimeSensor":
          {
            "@DEF": "Timer",
            "@cycleInterval": 0.05,
            "@loop": true
          }
        },
        { "Script":
          {
            "@DEF": "CubesScript",
            "field": [
              {
                "@accessType": "inputOnly",
                "@type": "SFTime",
                "@name": "set_time",
              },
              {
                "@accessType": "initializeOnly",
                "@type": "MFInt32",
                "@name": "matrix",
                "@value": [ 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 2, 2, 2, 2, 2, 2, 2, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 2, 1, 1, 1, 1, 1, 0, 2 ]
              },
              {
                "@accessType": "initializeOnly",
                "@type": "SFNode",
                "@name": "shape",
                "-children": [
                  { "Shape":
                    {
                      "@USE": "ColorCube"
                    }
                  }
                ]
              },
              {
                "@accessType": "initializeOnly",
                "@type": "SFNode",
                "@name": "group",
                "-children": [
                  { "Group":
                    {
                      "@USE": "Cubes"
                    }
                  }
                ]
              }
            ],
            "#sourceText": [
"ecmascript:",
"",
"var",
"\tdimension = 7,",
"\toffset    = 1",
"\tsize      = 2,",
"\tposition  = [0, 0, 0],",
"\tcache     = new MFNode ();",
"",
"function initialize ()",
"{",
"\tcache .assign (group .children);",
"\tgroup .children .length = 0;",
"",
"\tfor (var i = 0; i < matrix .length; ++ i)",
"\t{",
"\t\tif (matrix [i])",
"\t\t\tmatrix [i] = 1;",
"\t}",
"",
"\tposition [0] = 0;",
"\tposition [1] = 0;",
"\tposition [2] = 0;",
"",
"\tcreateCube (position);",
"}",
"",
"function set_time (value, time)",
"{",
"\tif (getNextPosition (position))",
"\t{",
"\t\tcreateCube (position);",
"\t}",
"\telse",
"\t{",
"\t\tinitialize ();",
"\t}",
"}",
"",
"function getNextPosition (position)",
"{",
"\tvar index = getIndex (position [2], position [1], position [0]);",
"",
"\tmatrix [index] = 2;",
"\t",
"\tfor (var zOffset = -1; zOffset < 2; ++ zOffset)",
"\t{",
"\t\tvar z = position [2] + zOffset;",
"\t",
"\t\tif (z < 0 || z >= dimension)",
"\t\t\tcontinue;",
"",
"\t\tfor (var yOffset = -1; yOffset < 2; ++ yOffset)",
"\t\t{",
"\t\t\tvar y = position [1] + yOffset;",
"",
"\t\t\tif (y < 0 || y >= dimension)",
"\t\t\t\tcontinue;",
"",
"\t\t\tfor (var xOffset = -1; xOffset < 2; ++ xOffset)",
"\t\t\t{",
"\t\t\t\tif (Math .abs (xOffset) + Math .abs (yOffset) + Math .abs (zOffset) > 1)",
"\t\t\t\t\tcontinue;",
"\t\t\t\t",
"\t\t\t\tvar x = position [0] + xOffset;",
"\t\t\t\t",
"\t\t\t\tif (x < 0 || x >= dimension)",
"\t\t\t\t\tcontinue;",
"\t\t\t\t",
"\t\t\t\tvar next = getIndex (z, y, x);",
"\t\t\t\t",
"\t\t\t\tif (matrix [next] == 1)",
"\t\t\t\t{",
"\t\t\t\t\t//print (x, \" \", y, \" \", z, \" \", next, \" \", matrix [next]);",
"",
"\t\t\t\t\tposition [0] = x;",
"\t\t\t\t\tposition [1] = y;",
"\t\t\t\t\tposition [2] = z;",
"",
"\t\t\t\t\treturn true;",
"\t\t\t\t}",
"\t\t\t}",
"\t\t}",
"\t}",
"",
"\t//print (false);",
"",
"\treturn false;",
"}",
"",
"function createCube (position)",
"{",
"\tif (cache .length)",
"\t{",
"\t\tvar transform = cache .pop ();",
"\t}",
"\telse",
"\t{\t",
"\t\tvar transform = Browser .currentScene .createNode (\"Transform\");",
"",
"\t\ttransform .children .push (shape);",
"\t}",
"",
"\ttransform .translation .x = position [0] * size + offset;",
"\ttransform .translation .y = position [1] * size + offset;",
"\ttransform .translation .z = -position [2] * size + offset;",
"\t",
"\tgroup .children .push (transform);",
"}",
"",
"function getIndex (z, y, x)",
"{",
"\treturn (z * dimension * dimension) + (dimension * y) + x;",
"}"
            ]
          }
        },
        { "ROUTE":
          {
            "@fromNode": "Timer",
            "@fromField": "cycleTime",
            "@toNode": "CubesScript",
            "@toField": "set_time"
          }
        }
      ]
    }
  }
}
